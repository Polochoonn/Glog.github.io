<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  
  <head>
    <script type="text/javascript" src="index.js"></script>
    <script type="text/javascript" src="3Dmol.js"></script>
    <script>
      var glviewer = null;
      var labels = [];
    
      var addLabels = function() {
        var atoms = glviewer.getModel().selectedAtoms({
          atom : "CA"
        });
        for ( var a in atoms) {
          var atom = atoms[a];
    
          var l = glviewer.addLabel(atom.resn + " " + atom.resi, {
            inFront : true,
            fontSize : 12,
            position : {
              x : atom.x,
              y : atom.y,
              z : atom.z
            }
          });
          atom.label = l;
          labels.push(atom);
        }
      };
      
      var colorSS = function(viewer) {
        //color by secondary structure
        var m = viewer.getModel();
        m.setColorByFunction({}, function(atom) {
          if(atom.ss == 'h') return "magenta";
          else if(atom.ss == 's') return "orange";
          else return "white";
        });
        viewer.render();
      }
    
      var atomcallback = function(atom, viewer) {
        if (atom.clickLabel === undefined
            || !atom.clickLabel instanceof $3Dmol.Label) {
          atom.clickLabel = viewer.addLabel(atom.elem + atom.serial, {
            fontSize : 14,
            position : {
              x : atom.x,
              y : atom.y,
              z : atom.z
            },
            backgroundColor: "black"
          });
          atom.clicked = true;
        }
    
        //toggle label style
        else {
    
          if (atom.clicked) {
            var newstyle = atom.clickLabel.getStyle();
            newstyle.backgroundColor = 0x66ccff;
    
            viewer.setLabelStyle(atom.clickLabel, newstyle);
            atom.clicked = !atom.clicked;
          }
          else {
            viewer.removeLabel(atom.clickLabel);
            delete atom.clickLabel;
            atom.clicked = false;
          }
    
        }
      };
    var readText = function(input,func) {
          if(input.files.length > 0) {
            var file = input.files[0];
            var reader = new FileReader();
              reader.onload = function(evt) {
                func(evt.target.result,file.name);
              };
              reader.readAsText(file);
              $(input).val('');
          }
        };
      $(document).ready(function() {
    
        moldata = data = $("#moldata_pdb_large").val();
        glviewer = $3Dmol.createViewer("gldiv", {
          defaultcolors : $3Dmol.rasmolElementColors
        });
        glviewer.setBackgroundColor(0xffffff);
    
        receptorModel = m = glviewer.addModel(data, "pqr");
    
        atoms = m.selectedAtoms({});
    
        for ( var i in atoms) {
          var atom = atoms[i];
          atom.clickable = true;
          atom.callback = atomcallback;
        }
    
        glviewer.mapAtomProperties($3Dmol.applyPartialCharges);
        glviewer.zoomTo();
        glviewer.render();
    
    
      });
    </script>
  </head>
  <div id="header"></div>
  <div class="grand-container">
  
    <body>
      <div id="gldiv" style="width: 100vw; height: 80vh; margin-top: 0%; padding: 0; border: 0;">
        <canvas id="undefined" style="width: 800px; height: 640px; padding: 0px; position: absolute; top: 0px; left: 0px; z-index: 0;" width="1600" height="1280"></canvas>
      </div>
    
      <hr style="margin: 0%;">
    
      <br>
      <input type="button" value="Stick" onclick="glviewer.setStyle({},{stick:{}}); glviewer.render();">
      <input type="button" value="Line" onclick="glviewer.setStyle({},{line:{}}); glviewer.render();">
      <input type="button" value="Cross" onclick="glviewer.setStyle({},{cross:{linewidth:2}}); glviewer.render();">
      <input type="button" value="Sphere" onclick="glviewer.setStyle({},{sphere:{}}); glviewer.render();">
      <input type="button" value="Cartoon" onclick="glviewer.setStyle({hetflag:false},{cartoon:{}}); glviewer.render();">
      <input type="button" value="Label alpha C's" onclick="addLabels(glviewer); glviewer.render();">
      <input type="button" value="Color SS" onclick="colorSS(glviewer);">
      <br>
      <input type="button" value="Surface1" onclick="surf1 = glviewer.addSurface($3Dmol.SurfaceType.VDW, {}, {hetflag:false,chain:'A'},{hetflag:false,chain:'A'});">
      <input type="button" value="Surface2" onclick="surf2 = glviewer.addSurface($3Dmol.SurfaceType.MS, {map:{prop:'partialCharge',scheme:new $3Dmol.Gradient.RWB(-.6,.6)}, opacity:0.85}, {chain:'B'},{chain:'B'});">
      <input type="button" value="RM Surfaces" onclick="glviewer.removeAllSurfaces();">
      <br>
      <input type="button" value="Recenter" onclick="glviewer.zoomTo();">
      <br>
      <input id="pdbid" value="1UBQ" size="4">
      <button onclick="glviewer.clear(); m = $3Dmol.download('pdb:' + $('#pdbid').val(), glviewer, {doAssembly:true, noSecondaryStructure: false});">Download</button>
      <br>
      <input type="file" onchange="readText(this, function(data, name) {glviewer.clear(); m= glviewer.addModel(data,name); glviewer.zoomTo(); glviewer.render();} );">
    
      
    
    
    <div id="accel-snackbar" style="left: 50%; transform: translate(-50%, 0px); top: 50px;"></div></body></html>
    </div>
  <link rel="stylesheet" href="stylesheet.css" />
  <link rel="stylesheet" href="prediction.css" />
</html>
